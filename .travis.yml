dist: bionic
services:
  - docker
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
  - pwd
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
before_script:
  - pwd
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
script:
  - pwd
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - bin/git-update.sh
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - docker-compose up -d
  - sleep 180
  - docker ps --format '{{.Image}}' | sort
# - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
#   - DIFF=$(diff docker_up_output.txt image_names.txt) 
#   - if [ "$DIFF" != "" ] ;  then
#        exit 1
#     fi