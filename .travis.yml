dist: bionic
git:
  submodules: false
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
before_script:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - sed -i 's/--abort-on-container-exit/-d/' bin/first-build.sh
  - cd fetch
  - git checkout develop
  - TAB=$'\t'
  - sed -i '/-c 5/ a \'"${TAB}"'\ until curl --silent -XGET --fail http://elasticsearch:9200; do printf \'.'\; sleep 1; done' Makefile
  - cd -
script:
  - ./bin/first-build.sh
  - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
  - DIFF=$(diff docker_up_output.txt test/image_names.txt)
  - if [ "${DIFF}" != "" ];  then exit 1; fi;
notifications:
  slack:
    secure: 05l+gGnrLO2ukOrNO1SXoO+QqhamZx0QK68I4dNsb0AwqhYhQrN1/F3Ww0BGYYMNgjlxJcodH0HfirwqvDMdxtABb7Ah/XLPNHHWHAB3gW7XWJQ0v6SPiEIOruGaLzD4ORVBWFyuonFPhPLcs1brn5Aevq8NHLWCU0YlgsKRyZ8+smFqeugGMMOlL6tcv3rU5DcJ6eow73ReSMGaA6JhYEU5mFt0R3JVQFsJcw0SvuvmdiHtPRlgM67pP+ZxiskY0cu6zNIyrlArzjmmTmMe+9K/QLKUabyjQ6BVsj2qQHijeWi1BcAWJ12WyM88pSsFdEM7Wtn50Zy24/OYEksbfEZ/q5N2FPVjberXgVRmS86Aj/+c1vEGckPr3lfszBapUDG2UGTG4q2CpjKL5zaOaccZiAMkH2n40EXJj45rRFh7oFdXePi68nbLQ3W8IbU8w3nZVQNtdUtKdDkU8cuf/feTL9K7SduKZECol8303h1ym5bUNFd8V4JXgj1ZfrYF+iyXytPrRobDeyKH2bxiYEn9jBVPogrfy3O5QOGRRoHJ89aRC/Q35/6MMT0H+MLPL25KPwGOHRVUQ2VpH45MW3/KEdo3HKIcbezLQvHC/s5e8p+sKUDgzmtMLrkF7U6j2XHCD8IuS0PwK4WTOzsvgR5kgy4FvCCaxXebgbKSMLU=
