dist: bionic
git:
  submodules: false
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
before_script:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - sed -i 's/--abort-on-container-exit/-d/' bin/first-build.sh
  - cd fetch
  - git checkout develop
  - TAB=$'\t'
  - sed -i '/-c 5/ a \'"${TAB}"'\ until curl --silent -XGET --fail http://elasticsearch:9200; do printf \'.'\; sleep 1; done' Makefile
  - cd -
script:
  - ./bin/first-build.sh
  - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
  - DIFF=$(diff docker_up_output.txt test/image_names.txt)
  - if [ "${DIFF}" != "" ];  then exit 1; fi;
# notifications:
#   slack:
#     secure: IzJHJYILxdPGU/MUu5le1O0BAoIyBkcOjdBh8geDYQEcVoRgPjHPsE41PBKGbMGblWE7CBIZ3duzCntmCrsBDv/lck6R0uoz9RNAYkTcAvqKerrOc69QJI1hppCLJoIU3hZqpXLwWW8GaaeCfHtpq+eMLJZX8AqomFauHdElwyRsUczGXOK1QFY21UuVAQBb97nKc2YvrVuR50Arms591QLTpvxLte+Ma+7/Na7wyR2AGk1P1pIZLzKPNCEq/XL/JwjdCOVApDQDia6t1VH8BQU59a0PwEZzAZ+BmBy5w0QMh9bs/4FbtoLRbZHeMo5u/OU3aN2FJerLv84oVP5Jbdtu6DG0lYx/JcZDRo/sX0+2UQfOOLcJTiJuOYeL73RniAoHgH8aWyeuR2UJ6cKylo4xXK0Z8XCz50AkVbhHLZrx7/MYtQFalvjjaer3b4r7M9qRL5qkP9h9hKGzs9s98U3oaek8YcTn6gpAonKJETdtRS7Y2upUQ4Mzp8cHQ8Tp/XEwmC3DbLI7TPy8B/LTS2IUl5iDZq6hC2kKb1yPCbKCKullyAnd6ivQdVb5YVViF3fGlQbc6bJ7hXm6kM6ohYkT623/OjgK8Vv1fDK71LHc1FjUxlpwtfHX749W3HG2I0RBd3PA66vAvimhV40Gr73hxzjFQbGZJC0YBL+bGCQ=

