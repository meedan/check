dist: bionic
git:
  submodules: false
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
before_script:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - sed -i 's/--abort-on-container-exit/-d/' bin/first-build.sh
  - cd fetch
  - git checkout develop
  - TAB=$'\t'
  - sed -i '/-c 5/ a \'"${TAB}"'\ until curl --silent -XGET --fail http://elasticsearch:9200;
    do printf \'.'\; sleep 1; done' Makefile
  - cd -
script:
  - "./bin/first-build.sh"
  - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
  - DIFF=$(diff docker_up_output.txt test/image_names.txt)
  - if [ "${DIFF}" != "" ];  then exit 1; fi;
notifications:
  slack:
    rooms:
      secure: LM8ub5Gg2ZRzW22SWNLdF/JYlxJyVyrnmlC3tQRT1vmR7CgPPjNsnMHUkVnXnQP/GWBOxwHeDEEe4NODpOOl/SOQBSmy0kx1q/bMk2K0wmjrcWXdRJI/vRk690khOKYMAI865Vx8pr2FBBsWe83oW/yDomrc69tbKN8t7rH0T7IL9U2cMi0AnDX+zWovYlzOT7y1BSGdcpV/JSbS+nSECO+kOaB99sRstJrnKKPB5M+s1QhJqSLB1bvHJI1I443Bu6J4fZS8oXluM3tKs7fgYjwUeaG30AIoKig1S9OrHzZ0+fWWW1ksDJoqPMvRpB9noHiAEUg3pFVv9AckPU4igFsCLJoTKYz6EQSyugmRl7gOlqFWFeRSFKeEVgdKWH90rE143/ZtebNHXM+DtzHygCMRY3wd7EMzlzuWQw4Ou0f89x5KWC3W8YkdAmHgxa6P04ofWiMM6EXCdcxo/FxwSpqMfHaveKrRrGTSBzb79ccf5HxoKwUzsdKLGDqJziAdIO2WgYbezMxD+FiMTuyTMFu2AmSpfnm/T6XZpY7Gn09PdQdfKsuzKJPNwjo/4MYjUf7PYLHJWC2pUXcotA7h7f+OojZ7iU+RWDyzsBflbiKtN5SYQ3UY+/3N60U2LO32A1vClokO3dQ8Ze62hUK1m3XSoE75A79sShRInI73ajY=
