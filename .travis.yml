dist: bionic
git:
  submodules: false
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
before_script:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - sed -i 's/--abort-on-container-exit/-d/' bin/first-build.sh
  - cd fetch
  - git checkout develop
  - TAB=$'\t'
  - sed -i '/-c 5/ a \'"${TAB}"'\ until curl --silent -XGET --fail http://elasticsearch:9200;
    do printf \'.'\; sleep 1; done' Makefile
  - cd -
script:
  - "./bin/first-build.sh"
  - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
  - DIFF=$(diff docker_up_output.txt test/image_names.txt)
  - if [ "${DIFF}" != "" ];  then exit 1; fi;
notifications:
  slack:
    secure: P+6l9pUhzFfHSK+pi21/QcuPVHA4BVx/4drx/zgunqxSghDQf5pQdTwnQ/BI1K8o7aU69jZD+ZGt9L5MwFFltzLijI7YsLQAFIB7WdHdNiJCgnXBBWNulw0HuTJFF1K2jWEkuSrKnUw6IzFmcXGQFLlb/bHa0luVS0FCU/9r+hH8RFL20Q2WwTXUiLR9BhE00Oq1DurltdbqoVTa/Lh7s0DJQ41X4ZyQauXN3XRFQdFXm2V0tR4/GRDLnmf4MvK+pHea9Lokx2BABIVXDIaEFaakUbS6ML4K3f/bcGHn4bP9Kb5YcHrxoDAKK3g6nNbGO0STGXP4WZdUTgXofoJlfj25sVlSmRgAqdEXSmLVc/HRJ+g9i3xWGNBHV6WUCnwUGlD8Wf8UhVTtXH4I9nKvcdckvPUZJ/ovBTNcvPgM8Xvu82dw3RaYfHp2C3jsDdFyEPDsjX722wLucPHrvkQz+TCvTiSqrYSholvPH8C2DcEQhrEN1iAH2+1XYVK47l3mgCwHG5MjqMTuhj98vvexg+dWigK4ONbmBqQLeFPUyneFkQXS0eEf+ooIn3r9hdhjCSURdJMb3Oz3hn/JvglUwbq+MzdSMEizDyKMFVZAK6PrKElP8hsn7zL091jsp9RmTNn7QEadHxtjCjGzkwgLHsec7yrwFx1KHRqkHPiB9M4=
