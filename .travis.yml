dist: bionic
git:
  submodules: false
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
before_script:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - sed -i 's/--abort-on-container-exit/-d/' bin/first-build.sh
  - cd fetch
  - git checkout develop
  - TAB=$'\t'
  - sed -i '/-c 5/ a \'"${TAB}"'\ until curl --silent -XGET --fail http://elasticsearch:9200; do printf \'.'\; sleep 1; done' Makefile
  - cd -
script:
  - ./bin/first-build.sh
  - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
  - DIFF=$(diff docker_up_output.txt test/image_names.txt)
  - if [ "${DIFF}" != "" ];  then exit 1; fi;
notifications:
  slack:
    rooms:
      secure: cS3/zfGIQ4pXEx5NqA8hSt6PGwA079YLZfLpqDOvFHJhtfa/hPeczRua1M3ytIZ1b0Mjqrm9sUA8funfKldznvkBHMirGnp+Dg/t8TlZZEaoK1OHzzR44FMG61BSccc00E4LAR1IleKBimCFbw+EnFFCCBh2v1JK63v1bftuHJKNZiNz5h3mJbzBKXMswCAdiciCvVMBPweAeDz6vHkCZ5YJiU2c0/5mRjIBZcPtBWxVkV/ChWEF+pTMUEgr4uwBSyYV1aujSAHe0KRLZcpiJtzislJ/w2osKhk5CmCCRvqZjPy5+UEtwInmM+63/nVVXVHXPTw87UExWZVC3/K0OvqO2peGr6zZC9ld+MfKfc06R8rh5hf3X7q3pdL87G+arfIkvkC9A6Iq2AjwcjlfZ3K6DZUDjUOuJw0eGptEMvcdnIuQGCVfSFTIj4stMLGPQ/bQKxhlnzHzAX6a5Mx0SvHVEg2N+is56SiiimfKeDFJ3uEXfKXG7DZXNTB3/eJfJEmQwq0SZzsIxOOhreEVOtYXqIZJYz2A5ar1mF5A53/DQOEAYFpc7ZQU20FZ1qQQoGnEWQv+YEB07D7i/W2LNwg9t1verfQEIduUaYwHyYX3uB2VNsJ3KeHvi96Bnm2uOW23TCfLAQV3WCp9CN6kWEuDbSLOQ8VPXAlSs2TtSQ0=
