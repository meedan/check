dist: bionic
git:
  submodules: false
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
before_script:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - sed -i 's/--abort-on-container-exit/-d/' bin/first-build.sh
  - cd fetch
  - git checkout develop
  - TAB=$'\t'
  - sed -i '/-c 5/ a \'"${TAB}"'\ until curl --silent -XGET --fail http://elasticsearch:9200; do printf \'.'\; sleep 1; done' Makefile
  - cd -
script:
  - ./bin/first-build.sh
  - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
  - DIFF=$(diff docker_up_output.txt test/image_names.txt)
  - if [ "${DIFF}" != "" ];  then exit 1; fi;
notifications:
  slack:
    secure: 2yjEnjj12w7h0tOh00sUYO9EuAyaybR3lHo4iSLuCn43w2ixnzDkNE46KgLT3wZw3YqNyDGobrEz9+Yk8nDd8CbAk4P7X9SuG5i6HRMTZR/QdFCitVAJHMGN0heKRSPCS5DiMQTkLsWeDlhGaN4i+fGzBc3p0/no8E3xe4r+XhbwBAc3S9p5ExhDcqHjabBwrtfM1b90+WzM3dMjMZrKgHlDVo0J1SQmNuIBNhdTpafyjLGCW0RzCTLusMUoUFhUq7WB9h/XJenJT+sa22CGMOxOiU03HpU5CeanJH9cNaGX5GY8twq48Ng77e9CRci8T0LsKltiRupUnoj5XdaUp5YCWOUB8PIwvOXIshPjMoPFvWto/s/SQOYK34zftCAQause7LrFcOJF0EICGfus0sxyjMVnZvN5rilPLm+h/Okyba3SoFePqkRYrkwJllx0HkeY2Rfr0rS+PWyWWg4T82nmQMT6nh52RKH9GYIhW3i86DXdznwK2WqAu2elyIfPmtcJUZeSMrfnvH3EYGjNFVcgpwo0w2+slHebluMRHs3ilDX97QinZwmx085Ty/ADHPnfB+3YUNAtHAxOkn0Cei+tK69mGXmzUgGaTqVoq+wcbHdoHqGYO5N4PuHECWFjg0p6ku4OciqBcGGeWeT2tDViImFNtldoza61qYhquuo=
