dist: bionic
git:
  submodules: false
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
before_script:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - sed -i 's/--abort-on-container-exit/-d/' bin/first-build.sh
  - cd fetch
  - git checkout develop
  - TAB=$'\t'
  - sed -i '/-c 5/ a \'"${TAB}"'\ until curl --silent -XGET --fail http://elasticsearch:9200; do printf \'.'\; sleep 1; done' Makefile
  - cd -
script:
  - ./bin/first-build.sh
  - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
  - DIFF=$(diff docker_up_output.txt test/image_names.txt)
  - if [ "${DIFF}" != "" ];  then exit 1; fi;
notifications:
  slack:
    secure: nLoXcXyEm6RAAfnLaT1qeWHFzz+Pg325fUen2hzZV0/wlkxXdoQtIhYl/fA8U1loQPgoxxamTv1Tyw7uWe159FhWCVKF5SMYQmw9XQ/A+XfD+pd67Tg8UcpAKDyCc9MGkHRxULg7rqe1RVHCu3JVOvIdVB7jgsRcj6uHokffsN64hxR4+oGMM4v3Zu9pQXZYdflVT3qm8vZ5nhucgeIshvdW54RBWoI2tKfo4OkG2JuR9ll+UwmlaqZyv2NDTJIlJr3oYc6BijjjPq8KOrFOUvM8QiwRzhyC1HJfEZZj9RaRhfwXxT/x4Z+KvDEU1C+0AW35lt0BSleqQ6bfssy4uh2y5JCr3/VV2ekNXR3VT6GdiadE7Heh+sbetZ1OTBUTNplQ4Ty9BwH5u2hOhBXS5j3mWwaZh5KpJc3G81rrNJ/uvPhmECvsamseY6TBrMAIkzWbZrI8C1M/JTHDd50JSIpdDjlnO9qqw58U9rH9nag6sv3zzdHcWz1h+8Mb0diKOrqRDl1hEZonhJmfi5VMay3Er0ejTfjg5guvfxfR7C8/HYR/ZsZFTyZXv8LszR2JLVmRiClddBqQVK364qSZIXyQ3TAEA4NrHLVzBsOOufmXfM9DMgTfVcc+N56v01gQmJ1HRwL7xhPH/lFA/32ASly50jEqFiEShaic6Jy2MbI=
