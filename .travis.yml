dist: bionic
git:
  submodules: false
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
before_script:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - sed -i 's/--abort-on-container-exit/-d/' bin/first-build.sh
  - cd fetch
  - git checkout develop
  - TAB=$'\t'
  - sed -i '/-c 5/ a \'"${TAB}"'\ until curl --silent -XGET --fail http://elasticsearch:9200;
    do printf \'.'\; sleep 1; done' Makefile
  - cd -
script:
  - "./bin/first-build.sh"
  - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
  - DIFF=$(diff docker_up_output.txt test/image_names.txt)
  - if [ "${DIFF}" != "" ];  then exit 1; fi;
notifications:
  slack:
    secure: uBlgWF4Dd218Cryd2ZFiY2segLnYSZZo0G5niUvYiJYwQs/brz8S3NQB4lilB7+7DuuccaWI4mfxR6cMGUVp17LJ4gRum9gtsytku1c2ttCLOGr8ZphbZmpXPxfJsYSB384SXozkXSk07pTNONAiMMSXpKf4NdEIoGHAvv9YBgB43md6m0LNmuuY07WO7iikhxRu1Ig+PkPWo46YnZ2l18AqV8wJdcqCnG/oyXUnipflIrbl0pamaHNarJVZed4KW+1gqWH8oqLEWCsrQukYrknwn94jNqPFcg2StCZpvit6fv17cZxSj8x2aaWStnLWXj4d8D7JdJVXise6WdanWgFCgicZ8ZrpLy1Fh0SbssnH+O8DZnbIJnFmX5PJfkMMHl50CzUW4B2TRscRaOJr3IngYVZb9VoseHC49/vmfxrLLTP6u1y+nmCNex4DL9eLBLXEhkXeNKalxncruyYuy/Wbb587j5Ph1C5AlavDfm0AbLh/WbytYX3MroSp+x4xXJXsGbXHobP3DxGtPwIHmLto5CIAFyfVIzBmzsLJjwcBUD9Grzd6Eerst+a+/8eSI5Pmgp+z9/URSOADno4eI9U63tQ8u9hOclc/NTNlbP6buiQ3zNDVcmSCsymdvQh2wOW2GQWlaTForxwuyoWWbQxyaDroMsOSeKUiNJ52I2M=
