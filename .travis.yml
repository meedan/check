dist: bionic
git:
  submodules: false
before_install:
  - git clone https://${TOKEN}:x-oauth-basic@github.com/meedan/configurator ./configurator
before_script:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
  - sed -i 's/--abort-on-container-exit/-d/' bin/first-build.sh
  - cd fetch
  - git checkout develop
  - TAB=$'\t'
  - sed -i '/-c 5/ a \'"${TAB}"'\ until curl --silent -XGET --fail http://elasticsearch:9200;
    do printf \'.'\; sleep 1; done' Makefile
  - cd -
script:
  - ./bin/first-build.sh
  - docker ps --format '{{.Image}}' | sort >> docker_up_output.txt
  - DIFF=$(diff docker_up_output.txt test/image_names.txt)
  - if [ "${DIFF}" != "" ];  then exit 1; fi;
notifications:
  slack:
    secure: IeD2IoJzU5dcOnyD7ptRQsTQ4IYMd/RGjLjXD0MXzIUn7Jcj3uAIz3ykRl69Y9GcTsmJrc0mKHKuBoqVm1pttxsJCtXlxP+x1PJ3gf7vVsQqdj9giqjOTVkV3BB6ue9+zp0XgwFC+6JKyw3+nKsmRT9xYbNYE3fs6Ktv/kqfohWRYI8+5BAsC+jN5QAGpLo9884tl0VvR/ruNCt6NUZaI7lszv3RcrTN48piRGARmIRLIg4GQsbDZeC6L0iPqEn5QYh99h/XV9NtWvwAdPGDveBJSMmyAtOH1CeSmBVbey+yVieX6TBULgAZplidzgu3ax0vYnLk40fAkspyGL/oyhpBJczh+VzRIe+WVH5HxJ1vtLnAz/sbNyZPq/6ZGS4IAjUTHH9uoRVQww9IfLnY+TfEmKSNSC/rlKXzqjl+RToQFVc190ZomBtxXvqjtIzsz7GeW5IdwFbF76TNWjjgtWfjuZ6F2W0uCUKakCvpjNDHk/TrT3stu12X83GCXlX/WnKqLlDGjIPhOvJ9/8op+KbUEX0kK9efPjjZMtUGl+rsPuicJGWYHsPN8t4LFdzbKRUp6nMb/aECTf8NZmVKtI4nV1/BcoPNjlD/LVdsncOgwrwzgaK5I2W5Bh8Y4e/Pb3e47y8QMkSqD0EaCQVSXE48vC+nxtyNjkWqK4UbsmQ=
